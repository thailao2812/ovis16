<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <record id="view_request_payment_form_inherit_security_gate_vietnam" model="ir.ui.view">
        <field name="name">view_request_payment_form_inherit_security_gate_vietnam</field>
        <field name="model">request.payment</field>
        <field name="inherit_id" ref="sd_purchase_contract.view_request_payment_form"/>
        <field name="arch" type="xml">
            <xpath expr="//header" position="replace">
                <header>
                    <button name="request_payment" string="Request" type="object" states="draft" class="oe_highlight"
                            groups="sd_security_gate_vietnam.group_request_payment"/>
                    <button name="action_refuse" string="Reject" type="object" class="oe_highlight" attrs="{'invisible': [('state', 'in', ['draft', 'paid'])]}" confirm="Are you sure to reject this request?"/>
                    <button name="security_approve" string="Security" type="object"
                            attrs="{'invisible': ['|', ('is_dr_request', '!=', True), ('state', '!=', 'request')]}"
                            class="oe_highlight"
                            groups="sd_security_gate_vietnam.group_security_request_payment"/>
                    <button name="approve_purchasing" string="Confirm" type="object"
                            attrs="{'invisible': ['|', ('is_dr_request', '=', True), ('state', '!=', 'request')]}" class="oe_highlight"
                            groups="sd_security_gate_vietnam.group_confirm_request_payment"/>
                    <button name="approve_purchasing" string="Confirm" type="object"
                            attrs="{'invisible': ['|', ('is_dr_request', '!=', True), ('state', '!=', 'security')]}" class="oe_highlight"
                            groups="sd_security_gate_vietnam.group_confirm_request_payment"/>
                    <button name="btt_approved" string="Approve Accounting 1st" type="object" states="purchasing" class="oe_highlight"
                            groups="sd_security_gate_vietnam.group_approve_1st_accounting_request_payment"/>
                    <button name="approve_accounting_v2" string="Approve Accounting 2st" type="object" states="approved" class="oe_highlight"
                            groups="sd_security_gate_vietnam.group_approve_2st_accounting_request_payment"/>
                    <button name="approve_by_director" string="Approve by Director" type="object" states="accounting_2" class="oe_highlight"
                            groups="sd_security_gate_vietnam.group_director_request_payment"/>
                    	<button states="approved_director" name="action_request_register_payment" type="object"
                                class="oe_highlight" context="{'dont_redirect_to_payments': True}"
                                string="Register Payment" data-hotkey="g" groups="account.group_account_invoice"/>

<!--                    print button-->
                    <button name="print_printout_payment_npv" string="Print Request Payment SVNP" type="object" class="oe_highlight" attrs="{'invisible': [('type', '!=', 'purchase')]}"/>
                    <button name="print_nvp_fix_from_npe" string="Advance Fix From NPE" type="object" class="oe_highlight" attrs="{'invisible': [('is_converted', '=', False)]}"/>

                    <button name="print_request_payment_npe" string="Print Request Payment NPE" type="object" class="oe_highlight" attrs="{'invisible': [('type', '!=', 'consign')]}"/>
                    <button name="print_advance_payment" string="Print Advance Payment NPE" type="object" class="oe_highlight" attrs="{'invisible': [('type', '!=', 'consign')]}"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,request,security,purchasing,approved,accounting_2,approved_director,paid"/>
                </header>

            </xpath>
            <xpath expr="//sheet" position="replace">
                <sheet>
                    <separator string="Contract Information"/>
                    <group>
                        <group>
                            <field name="is_dr_request" invisible="1"/>
                            <field name="type_of_ptbf_payment" invisible="1"/>
                            <field name="partner_id" readonly="1"/>
                            <field name="product_id" invisible="1"/>
                            <field name="purchase_contract_id" readonly="1"/>
                            <field name="parent_id_purchase_contract" readonly="1" force_save="1"  invisible="1"/>
                            <field name="product_id"/>
                            <field name="certificate_id"/>
                            <field name="paid_quantity" groups="sd_security_gate_vietnam.group_request_payment_seeing_money_value"/>
                            <field name="balance_quantity" groups="sd_security_gate_vietnam.group_request_payment_seeing_money_value"/>
                            <field name="type" invisible="1"/>
                            <field name="attachment_ids" widget="many2many_binary" string="Attach a file"/>
                            <field name="is_converted" invisible="1"/>
                        </group>
                        <group>
                            <field name="type"/>
                            <field name="date_contract"/>
                            <field name="quantity_contract" string="Quantity Contract"/>
                            <field name="fix_price" attrs="{'invisible': [('type', '=', 'consign')]}" readonly="1" groups="sd_security_gate_vietnam.group_request_payment_seeing_money_value"/>
                            <field name="price_npe" attrs="{'invisible': [('type', '=', 'purchase')]}" readonly="1" groups="sd_security_gate_vietnam.group_request_payment_seeing_money_value"/>
                            <field name="amount_untaxed" groups="sd_security_gate_vietnam.group_request_payment_seeing_money_value" options="{'currency_field': 'currency_id'}"/>
                            <field name="name" readonly="1"/>
                            <field name="currency_id" readonly="1"/>
                            <field name="date"/>
                        </group>
                    </group>
<!--                    <separator string="Fixation Information" attrs="{'invisible': ['|', ('type_of_ptbf_payment', '!=', 'fixation'), ('type', '!=', 'ptbf')]}"/>-->
<!--                    <group attrs="{'invisible': ['|', ('type_of_ptbf_payment', '!=', 'fixation'), ('type', '!=', 'ptbf')]}">-->
<!--                        <group>-->
<!--                            <field name="payment_quantity"/>-->
<!--                            <field name="price_usd"/>-->
<!--                            <field name="price_diff"/>-->
<!--                            <field name="final_price_usd"/>-->
<!--                            <field name="rate"/>-->
<!--                            <field name="final_price_vnd"/>-->
<!--                            <field name="request_amount"/>-->
<!--                        </group>-->
<!--                    </group>-->
<!--                    <separator string="Advance Information" attrs="{'invisible': ['|', ('type_of_ptbf_payment', '!=', 'advance'), ('type', '!=', 'ptbf')]}"/>-->
<!--                    <group attrs="{'invisible': ['|', ('type_of_ptbf_payment', '!=', 'advance'), ('type', '!=', 'ptbf')]}">-->
<!--                        <group>-->
<!--                            <field name="quantity_advance"/>-->
<!--                            <field name="liffe_price"/>-->
<!--                            <field name="price_diff"/>-->
<!--                            <field name="differencial_price"/>-->
<!--                            <field name="advance_price_usd"/>-->
<!--                            <field name="total_advance_payment_usd"/>-->
<!--                            <field name="rate"/>-->
<!--                            <field name="advance_price_vnd"/>-->
<!--                        </group>-->
<!--                    </group>-->
<!--                    <separator string="Fixation For Advance" attrs="{'invisible': ['|', ('type_of_ptbf_payment', '!=', 'advance'), ('type', '!=', 'ptbf')]}"/>-->
<!--                    <group attrs="{'invisible': ['|', ('type_of_ptbf_payment', '!=', 'advance'), ('type', '!=', 'ptbf')]}">-->
<!--                        <group>-->
<!--                            <field name="fixation_advance_ids" domain="[('purchase_contract_id', '=', parent_id_purchase_contract)]"-->
<!--                                   attrs="{'required': [('type_of_ptbf_payment', 'in', ['fixation_advance'])], 'invisible': [('type_of_ptbf_payment', '!=', 'fixation_advance')]}">-->
<!--                                <tree editable="top">-->
<!--                                    <field name="name"/>-->
<!--                                    <field name="quantity_advance"/>-->
<!--                                    <field name="remain_qty_advance"/>-->
<!--                                    <field name="quantity_fix_advance"/>-->
<!--                                </tree>-->
<!--                            </field>-->
<!--                            <field name="qty_advance_fix" readonly="1"/>-->
<!--                            <field name="price_usd"/>-->
<!--                            <field name="price_diff"/>-->
<!--                            <field name="final_price_usd"/>-->
<!--                            <field name="rate"/>-->
<!--                        </group>-->
<!--                    </group>-->
                    <separator string="Payment Information"/>
                    <group>
                        <group>
                            <field name="payment_quantity"/>
                            <field name="fix_price" string="Payment Price" groups="sd_security_gate_vietnam.group_request_payment_seeing_money_value"/>
                            <field name="total_value" groups="sd_security_gate_vietnam.group_request_payment_seeing_money_value"/>
                            <field name="advance_payment_converted" attrs="{'invisible': [('is_converted', '!=', True)]}" groups="sd_security_gate_vietnam.group_request_payment_seeing_money_value"/>
                            <field name="total_interest" attrs="{'invisible': [('is_converted', '!=', True)]}" groups="sd_security_gate_vietnam.group_request_payment_seeing_money_value"/>
                            <field name="deposit_amount" attrs="{'invisible': [('is_converted', '=', True)]}" groups="sd_security_gate_vietnam.group_request_payment_seeing_money_value"/>
                            <field name="liquidation_amount" groups="sd_security_gate_vietnam.group_request_payment_seeing_money_value"/>
                            <field name="request_amount" decoration-danger="request_amount > 0" groups="sd_security_gate_vietnam.group_request_payment_seeing_money_value"/>
                            <field name="amount_in_text" class="bold-text" groups="sd_security_gate_vietnam.group_request_payment_seeing_money_value"/>
                            <field name="partner_bank_id" domain="[('partner_id','=',partner_id)]" required="1"/>
                            <field name="account_no"/>
                            <field name="chinhanh"/>
                            <field name="delivery_array" invisible="1"/>
                            <field name="grn_90_array" invisible="1"/>
                            <field name="grn_100_factory_array" invisible="1"/>
                            <field name="grn_100_fot_array" invisible="1"/>
                            <field name="hide_delivery" invisible="1"/>
                            <field name="hide_grn_ready" invisible="1"/>
                            <field name="hide_grn_done" invisible="1"/>
                            <field name="hide_grn_fot_done" invisible="1"/>
                            <field name="have_dr_ktn" invisible="1"/>
                            <field name="have_dr" invisible="1"/>
                            <field name="have_grn_90" invisible="1"/>
                            <field name="have_grn_100" invisible="1"/>
                            <field name="have_grn_fot" invisible="1"/>
                        </group>
                        <group>
                            <separator string="Approval Information"/>
                            <field name="user_process_ids" readonly="1" no_label="1">
                                <tree>
                                    <field name="user_id"/>
                                    <field name="date"/>
                                    <field name="state"/>
                                </tree>
                            </field>
                        </group>
                    </group>
                    <separator string="Delivery Registration KTN" attrs="{'invisible': [('have_dr_ktn', '=', False)]}"/>
                    <field name="delivery_70_ktn_ids" readonly="1" attrs="{'invisible': [('have_dr_ktn', '=', False)]}">
                        <tree editable="bottom">
                            <field name="delivery_id"/>
                            <field name="quantity" sum="quantity"/>
                            <field name="percent" readonly="1"/>
                            <field name="total_qty" sum="total_qty"/>
                            <field name="remain_qty" sum="remain_qty"/>
                            <field name="paid_quantity" sum="paid_qty"/>
                            <field name="request_qty" context="{'seq': parent.name}" sum="request_qty"/>
                        </tree>
                    </field>
                    <separator string="Delivery Registration 70%" attrs="{'invisible': [('have_dr', '=', False)]}"/>
                    <field name="delivery_70_ids" readonly="1" attrs="{'invisible': [('have_dr', '=', False)]}">
                        <tree editable="bottom">
                            <field name="delivery_id"/>
                            <field name="quantity" sum="quantity"/>
                            <field name="percent" readonly="1"/>
                            <field name="total_qty" sum="total_qty"/>
                            <field name="remain_qty" sum="remain_qty"/>
                            <field name="paid_quantity" sum="paid_qty"/>
                            <field name="request_qty" context="{'seq': parent.name}" sum="request_qty"/>
                        </tree>
                    </field>
                    <separator string="GRN Factory 90%" attrs="{'invisible': [('have_grn_90', '=', False)]}"/>
                    <field name="grn_90_ids" readonly="1" attrs="{'invisible': [('have_grn_90', '=', False)]}">
                        <tree editable="bottom">
                            <field name="picking_id"/>
                            <field name="quantity" sum="quantity"/>
                            <field name="percent" readonly="1"/>
                            <field name="total_qty" sum="total_qty"/>
                            <field name="remain_qty" sum="remain_qty"/>
                            <field name="paid_quantity" sum="paid_qty"/>
                            <field name="request_qty" context="{'seq': parent.name}" sum="request_qty"/>
                        </tree>
                    </field>
                    <separator string="GRN 100% Factory" attrs="{'invisible': [('have_grn_100', '=', False)]}"/>
                     <field name="grn_100_factory_ids" readonly="1" attrs="{'invisible': [('have_grn_100', '=', False)]}">
                        <tree editable="bottom">
                            <field name="picking_id"/>
                            <field name="quantity" sum="quantity"/>
                            <field name="percent" readonly="1"/>
                            <field name="total_qty" sum="total_qty"/>
                            <field name="remain_qty" sum="remain_qty"/>
                            <field name="paid_quantity" sum="paid_qty"/>
                            <field name="request_qty" context="{'seq': parent.name}" sum="request_qty"/>
                        </tree>
                    </field>
                    <separator string="GRN 100% FOT" attrs="{'invisible': [('have_grn_fot', '=', False)]}"/>
                    <field name="grn_100_fot_ids" readonly="1" attrs="{'invisible': [('have_grn_fot', '=', False)]}">
                        <tree editable="bottom">
                            <field name="picking_id"/>
                            <field name="quantity" sum="quantity"/>
                            <field name="percent" readonly="1"/>
                            <field name="total_qty" sum="total_qty"/>
                            <field name="remain_qty" sum="remain_qty"/>
                            <field name="paid_quantity" sum="paid_qty"/>
                            <field name="request_qty" context="{'seq': parent.name}" sum="request_qty"/>
                        </tree>
                    </field>
                    <separator string="Status of Goods" attrs="{'invisible': [('is_converted', '=', True)]}"/>
                    <field name="status_goods_ids" widget="section_and_note_one2many" no_label="1"  attrs="{'invisible': [('is_converted', '=', True)]}">
                        <tree editable="top">
                            <field name="display_type" invisible="1"/>
                            <field name="name" readonly="1" options="{'no_open': True, 'no_create': True}" force_save="1"/>
                            <field name="payment_percent" readonly="1" force_save="1"/>
                            <field name="code" invisible="1"/>
                            <field name="purchase_contract_id" invisible="1"/>
                            <field name="purchase_contract_id" invisible="1"/>
                            <field name="sequence" invisible="1"/>
                            <field name="picking_ids" readonly="0" widget="many2many_tags" options="{'no_create': True}"
                                   attrs="{'readonly': [('payment_percent', 'in', [70, 80])]}"
                                   context="{'request_payment': True, 'payment_percent': payment_percent, 'code': code,
                                   'purchase_contract_id': purchase_contract_id, 'sequence': sequence}"/>
                            <field name="delivery_registration_ids" readonly="0" widget="many2many_tags" options="{'no_create': True}"
                                   context="{'request_payment': True, 'partner_id': parent.partner_id, 'product_id': parent.product_id}" attrs="{'readonly': [('payment_percent', '!=', 70)]}"/>
                            <field name="total_quantity" sum="total_quantity"/>
                            <field name="paid_quantity" sum="paid_quantity"/>
                            <field name="request_quantity" string="Payment Quantity" sum="request_quantity"/>
                        </tree>
                    </field>
                    <separator string="History Payment Quantity" attrs="{'invisible': [('is_converted', '=', True)]}" groups="sd_security_gate_vietnam.group_request_payment_seeing_money_value"/>
                    <field name="history_quantity_payment" widget="x2many_2d_matrix"  field_x_axis="name" field_y_axis="quantity_char"
                           field_value="quantity" show_row_totals="False" show_column_totals="False" attrs="{'invisible': [('is_converted', '=', True)]}" groups="sd_security_gate_vietnam.group_request_payment_seeing_money_value">
                        <tree>
                            <field name="name"/>
                            <field name="quantity_char"/>
                            <field name="quantity"/>
                        </tree>
                    </field>
                    <div attrs="{'invisible': [('is_converted', '=', True)]}" groups="sd_security_gate_vietnam.group_request_payment_seeing_money_value">
                        <label for="payment_quantity"/> <span>: </span>
                        <field name="payment_quantity"/>
                    </div>
                    <div attrs="{'invisible': [('is_converted', '=', True)]}" groups="sd_security_gate_vietnam.group_request_payment_seeing_money_value">
                        <label for="quantity_contract" string="Quantity Contract"/> <span>: </span>
                        <field name="quantity_contract"/>
                    </div>
                    <div attrs="{'invisible': [('is_converted', '=', True)]}" groups="sd_security_gate_vietnam.group_request_payment_seeing_money_value">
                        <label for="current_balance"/> <span>: </span>
                        <field name="current_balance"/>
                    </div>
                    <separator string="Fixation Detail" attrs="{'invisible': [('is_converted', '!=', True)]}" groups="sd_security_gate_vietnam.group_request_payment_seeing_money_value"/>
                    <field name="converted_line_ids" attrs="{'invisible': [('is_converted', '!=', True)]}" readonly="1" groups="sd_security_gate_vietnam.group_request_payment_seeing_money_value">
                        <tree>
                            <field name="fixation_qty"/>
                            <field name="purchase_contract_id"/>
                            <field name="fixation_price"/>
                            <field name="advance_payment" sum="advance_payment"/>
                            <field name="advance_date"/>
                            <field name="interest_rate"/>
                            <field name="total_days"/>
                            <field name="interest" sum="interest"/>
                        </tree>
                    </field>
                    <notebook>
                        <page string="Payment">
                            <field name="request_payment_ids" readonly="1" nolabel="1">
                                <tree>
                                    <field name="date"/>
                                    <field name="name"/>
                                    <field name="partner_id" string="Supplier" invisible="1"/>
                                    <field name="journal_id"/>
                                    <field name="amount" sum="amount"/>
                                    <field name="payment_refunded" sum="payment_refunded"/>
                                    <field name="open_advance" sum="open_advance"/>
                                    <field name="state" invisible="1"/>
                                    <field name="currency_id" invisible="1"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </xpath>
        </field>
    </record>

    <record id="view_request_payment_tree_inherit_security_gate_vietnam" model="ir.ui.view">
        <field name="name">view_request_payment_tree_inherit_security_gate_vietnam</field>
        <field name="model">request.payment</field>
        <field name="inherit_id" ref="sd_purchase_contract.view_request_payment_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='request_amount']" position="attributes">
                <attribute name="groups">sd_security_gate_vietnam.group_request_payment_seeing_money_value</attribute>
            </xpath>
            <xpath expr="//field[@name='total_payment']" position="attributes">
                <attribute name="groups">sd_security_gate_vietnam.group_request_payment_seeing_money_value</attribute>
            </xpath>
            <xpath expr="//field[@name='total_remain']" position="attributes">
                <attribute name="groups">sd_security_gate_vietnam.group_request_payment_seeing_money_value</attribute>
            </xpath>
            <xpath expr="//field[@name='payment_refunded']" position="attributes">
                <attribute name="groups">sd_security_gate_vietnam.group_request_payment_seeing_money_value</attribute>
            </xpath>
            <xpath expr="//field[@name='open_advance']" position="attributes">
                <attribute name="groups">sd_security_gate_vietnam.group_request_payment_seeing_money_value</attribute>
            </xpath>
            <xpath expr="//field[@name='state']" position="after">
                <field name="is_attach_file" decoration-success="is_attach_file != ''"/>
            </xpath>
        </field>
    </record>
</odoo>