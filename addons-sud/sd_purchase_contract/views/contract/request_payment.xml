<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <record id="view_request_payment_filter" model="ir.ui.view">
            <field name="name">view.request.payment.filter</field>
            <field name="model">request.payment</field>
            <field name="arch" type="xml">
                <search string="request.payment">
                	<field name="purchase_contract_id" string="Contract"/>	
                    <field name="partner_id" operator="child_of"/>
                    <group expand="0" string="Filter...">
                    	<filter string="NPE" name="type_consign" domain="[('type','=','consign')]"/>
                    	<filter string="NVP" name="type_purchase" domain="[('type','=','purchase')]"/>
                    	
                    </group>
                    <group expand="0" string="Group By...">
                    	<filter string="Type" name="group_type" icon="terp-accessories-archiver" domain="[]" context="{'group_by':'type'}"/>
                    	<filter string="Supplier" name="group_partner_id" icon="terp-accessories-archiver" domain="[]" context="{'group_by':'partner_id'}"/>
                    </group>
                </search>
            </field>
        </record>
        
    	<record id="view_request_payment_tree" model="ir.ui.view">
            <field name="name">request.payment.tree</field>
            <field name="model">request.payment</field>
            <field name="arch" type="xml">
                <tree string="Request Payment" decoration-info="state == 'request'" default_order="id desc" decoration-muted="state == 'paid'">
                	<field name="purchase_contract_id" optional="show"/>
                	<field name="partner_id" optional="show"/>
                	<field name="bank_id" optional="show"/>
                	<field name="partner_bank_id" domain="[('partner_id','=',partner_id)]" optional="show"/>
                    <field name="name" optional="show"/>
                    <field name="date" optional="show"/>
                    <field name="users_request_id" optional="show"/>
                     <field name="payment_quantity" sum="payment_quantity" optional="show"/>
                    <field name="advance_payment_quantity" invisible="1" optional="show"/>
                    <field name="advance_price" invisible="1" optional="show"/>
                    <field name="request_amount" optional="show"/>
                    <field name="total_payment" sum="total_payment" optional="show"/>
                    <field name="total_remain" sum="total_remain" optional="show"/>
                    <field name="payment_refunded" sum="payment_refunded" optional="show"/>
                    <field name="open_advance" sum="open_advance" optional="show"/>
                    <field name="provisional_amount" optional="show"/>
                    <field name="state" optional="show"/>
                    <field name="type" invisible="1" optional="show"/>
                </tree>
            </field>
        </record>
        
        
    	
    	<record id="view_request_payment_form" model="ir.ui.view">
            <field name="name">request.payment.form</field>
            <field name="model">request.payment</field>
            <field name="arch" type="xml">
                <form string="Request Payment">
	                <header>
	                	<button attrs="{'invisible': [('state', '=', 'request')]}"  
	                		name="action_request_register_payment" 
	                		type="object" 
	                		class="oe_highlight" 
	                		context="{'dont_redirect_to_payments': True}" 
	                		string="Register Payment" data-hotkey="g" groups="account.group_account_invoice"/>
	                    
                        
	                    <button name="print_advance_payment" type="object" string="Print Advance Payment" attrs="{'invisible': [('type','!=','purchase')]}"/>
	                    <button name="print_printout_payment_npv" type="object" string="Printout Payment NPV" attrs="{'invisible': [('type','!=','purchase')]}"/>
			            <button name="print_payment_request" type="object" string="Print Payment Request" attrs="{'invisible': [('type','!=','purchase')]}"/>
	                	<button name="btt_approved" string="Approved" type ="object" states="request"/> 
	                	<button name="btt_cancel" string="Cancel" type ="object" attrs="{'invisible': [('state', '=', 'request')]}"/> 
	                	<field name="state" widget="statusbar" statusbar_visible="request,approved,paid"/>
	                </header>
	                <sheet>
	                	<div class="oe_button_box" name="button_box" attrs="{'invisible': [('payment_count','=',0)]}">
		                	<button type="object" name="action_view_payment" class="oe_stat_button" icon="fa-truck">
								<field name="payment_count" widget="statinfo" string="Payment"/>
							</button>
						</div>
		                <div class="oe_title">
	                        <h1>
	                            <field name="purchase_contract_id" readonly="0"/>
	                        </h1>
	                    </div>
	                	<group>
	                        <group>
	                            <field name="name"/>
	                            <field name="partner_id" options="{'no_open': True, 'no_create': True}"/>
			                    <field name="advance_price"/>
			                    <field name="users_request_id" required="1"/>
			                    <field name="partner_bank_id" options="{'no_create': True}" domain="[('partner_id','=',partner_id)]"/>
			                    <field name="bank_id"/>
			                     <field name="chinhanh"/>
		                    </group>
		                    <group>
			                     <field name="date"/>
			                    <field name="advance_payment_quantity"/>
			                    <field name="request_amount"/>
	                            <field name="total_remain" readonly="1"/>
	                            <field name="amount_approved"/>
	                            <field name="songay"/>
	                            <field name="payment_quantity"/>
	                            <field name="type" invisible="1"/>
	                        </group>
	                        </group>
	                        
	                        <newline/>
	                        <notebook>
	                        	<page string="Rate" >
	                        		<field name="rate_ids">
	                        			<tree editable="top">
	                        				<field name="month" invisible="1"/>
	                        				<field name="date"/>
	                        				<field name="date_end"/>
	                        				<field name="rate"/>
	                        				<field name="provisional_rate" sum="provisional_rate"/>
	                        			</tree>
	                        		</field>
	                        	</page>
	                        	<page string="Payment">
	                        		<field name="request_payment_ids" readonly="1" nolabel="1">
	                        			<tree>
		                    				<field name="date"/>
		                    				<field name="name"/>
		                    				<field name="partner_id" string="Supplier" invisible="1"/>
		                    				<field name="journal_id"/>
		                    				<field name="amount" sum="amount"/>
		                    				<field name="payment_refunded" sum="payment_refunded"/>
		                    				<field name="open_advance" sum="open_advance"/>
		                    				<field name="state" invisible="1"/>
		                    				<field name="currency_id" invisible="1"/>
		                    			</tree>
		                        	</field>
	                        	</page>
	                        </notebook>
	                	
                	</sheet>
                </form>
            </field>
        </record>
        
        <record id="action_request_payment" model="ir.actions.act_window">
            <field name="name">Payment Request</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">request.payment</field>
            <field name="view_mode">tree,form</field>
            <field name="context" eval="{}"/>
            <field name="search_view_id"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
              		Create a Request Payment, the first step of a new Request.
              </p>
            </field>
        </record>
        
        
        
        
    </data>
</odoo>